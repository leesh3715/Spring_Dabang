<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.sist.model.ShareeDAO">
	 <select id="s_countlist" resultType="Integer">
  		select count(*) from sharee
  	</select>

	<select id="s_comments_count" parameterType="int" resultType="int">
  		select count(*) from comments where s_no= #{s_no}
  	</select>

	<select id="s_list" resultType="com.sist.model.ShareeDTO" parameterType="int"> <!-- 이름이 list이고, 리턴은 BOARDDTO 타입으로  -->
		<![CDATA[ select * from(select p.*, row_number() over(order by s_group desc,s_step) rnum from sharee p) where rnum>=#{s_startNo} and rnum<=#{s_endNo}]]>	
	</select>
	
	<select id="s_grouplist" resultType="com.sist.model.ShareeDTO" parameterType="int"> <!-- 이름이 list이고, 리턴은 BOARDDTO 타입으로  -->
		select * from sharee where s_group = #{s_group} order by s_step	
	</select>
	
	<insert id="s_add" parameterType="com.sist.model.ShareeDTO"><!--  -->
		insert into sharee values(sharee_SEQ.nextval, #{s_title}, #{s_cont}, #{s_memo},#{s_writer}, sysdate, default, sharee_SEQ.currval, 0, 0, #{s_src},0,'가전가구 나눔')	
	</insert>
	
  	<update id="s_replyup" parameterType="com.sist.model.ShareeDTO">
  		update sharee set  s_step = s_step+1 where s_group=#{s_group} and s_step > #{s_step} 
  	</update>
  	
	<insert id="s_replyadd" parameterType="com.sist.model.ShareeDTO"><!--  -->
		insert into sharee values(sharee_SEQ.nextval, #{s_title}, #{s_cont}, #{s_memo},#{s_writer}, sysdate, default, #{s_group}, #{s_step}+1, #{s_indent}+1, #{s_src},0,'가전가구 나눔')	
	</insert>
	
  	<update id="s_count" parameterType="int">
  		update sharee set s_hit = s_hit + 1 where s_no = #{s_no}
  	</update>
  	
  	<select id="s_cont" parameterType="int" resultType="com.sist.model.ShareeDTO">
  		select * from sharee where s_no = #{s_no}
  	</select>
  	
  	<delete id="s_delete" parameterType="int">
  		delete from sharee where s_no = #{s_no}
  	</delete>
  	<delete id="s_delete2" parameterType="java.util.ArrayList">
		delete from sharee where <foreach collection="list" item="s_no" separator="or"> s_no = #{s_no} </foreach>
	</delete>
  	
  	<update id="s_update" parameterType="com.sist.model.ShareeDTO">
  		update sharee set  s_date = sysdate, s_cont = #{s_cont}, s_memo = #{s_memo}, s_src = #{s_src}, s_title=#{s_title} where s_no = #{s_no} 
  	</update>
  	<insert id="c_add" parameterType="com.sist.model.CommentsDTO">
		insert into comments values(comments_SEQ.nextval, #{s_no}, #{c_id}, #{c_cont}, sysdate, comments_SEQ.currval, 0, 0, 0,'')	
	</insert>
  	
  	<delete id="c_delete" parameterType="int">
  		delete from comments where c_no = #{c_no}
  	</delete>
  	
  	<update id="c_delete2" parameterType="int">
  		update comments set c_check1= 1 where c_no = (select min(c_no) from comments where c_group= #{c_group})
  	</update>
  	
  	<select id="c_deletecheck" parameterType="int" resultType="int">
  		select count(*) from comments where c_group= #{c_no}
  	</select>
  	
  	
  	
  	<select id="c_check" parameterType="int" resultType="com.sist.model.CommentsDTO">
  		select c_no,c_step from comments where c_no=(select min(c_no) from comments where c_group= #{c_group})
  	</select>
  	
  	<select id="c_list" parameterType="int" resultType="com.sist.model.CommentsDTO"> <!-- 이름이 list이고, 리턴은 BOARDDTO 타입으로  -->
		<![CDATA[select * from (select p.*,row_number() over(order by c_group, c_step) rnum from comments p where s_no=#{s_no}) where rnum>=#{s_startNo} and rnum<=#{s_endNo}]]>
	</select>
<!--   	<select id="c_list" parameterType="int" resultType="com.sist.model.CommentsDTO"> 이름이 list이고, 리턴은 BOARDDTO 타입으로 
		select * from comments where s_no=#{s_no} order by c_group, c_step
	</select> -->
  	<update id="c_update" parameterType="com.sist.model.ShareeDTO">
  		update comments set  c_date = sysdate, c_cont = #{c_cont} where c_no = #{c_no} 
  	</update>
  
	<insert id="c_radd" parameterType="com.sist.model.CommentsDTO">
		insert into comments values(comments_SEQ.nextval, #{s_no}, #{c_id}, #{c_cont}, sysdate, #{c_group} ,(select max(c_step) from comments where c_group = #{c_group})+1 , #{c_indent}+1,0,#{c_replyid})	
	</insert>
  	
  	<select id="s_title" parameterType="com.sist.model.SearchDTO" resultType="com.sist.model.ShareeDTO">
  		<![CDATA[ select * from(select p.*, row_number() over(order by s_group desc,s_step) rnum from sharee p where s_title like '%'||#{find_name}||'%') where rnum>=#{s_startNo} and rnum<=#{s_endNo}]]>
  		
  	</select>
  	<select id="s_content" parameterType="com.sist.model.SearchDTO" resultType="com.sist.model.ShareeDTO">
	  	<![CDATA[ select * from(select p.*, row_number() over(order by s_group desc,s_step) rnum from sharee p where s_cont like '%'||#{find_name}||'%') where rnum>=#{s_startNo} and rnum<=#{s_endNo}]]>
  		
  	</select>
  	<select id="s_title_cont" parameterType="com.sist.model.SearchDTO" resultType="com.sist.model.ShareeDTO">
  		<![CDATA[ select * from(select p.*, row_number() over(order by s_group desc,s_step) rnum from sharee p where s_title like '%'||#{find_name}||'%' or s_cont like '%'||#{find_name}||'%') where rnum>=#{s_startNo} and rnum<=#{s_endNo}]]>
  		
  	</select>
  	<select id="s_writer" parameterType="com.sist.model.SearchDTO" resultType="com.sist.model.ShareeDTO">
  		<![CDATA[ select * from(select p.*, row_number() over(order by s_group desc,s_step) rnum from sharee p where s_writer like '%'||#{find_name}||'%') where rnum>=#{s_startNo} and rnum<=#{s_endNo}]]>
  	</select>
  	 
  	 <select id="s_titlecount" resultType="Integer" parameterType="String">
  		select count(*) from sharee where s_title like '%'||#{find_name}||'%'
  	</select>
  	 <select id="s_contentcount" resultType="Integer" parameterType="String">
  		select count(*) from sharee where s_cont like '%'||#{find_name}||'%'
  	</select>
  	 <select id="s_title_contcount" resultType="Integer" parameterType="String">
  		select count(*) from sharee where s_title like '%'||#{find_name}||'%' or s_cont like '%'||#{find_name}||'%'
  	</select>
  	 <select id="s_writercount" resultType="Integer" parameterType="String">
  		select count(*) from sharee where s_writer like '%'||#{find_name}||'%'
  	</select>
  	
  	<select id="s_next" parameterType="int" resultType="com.sist.model.ShareeDTO">
  		<![CDATA[select * from (select p.*, row_number() over(order by s_group desc,s_step) rnum from sharee p where s_group=(select max(s_group) from (select s_group from sharee where s_group<#{s_group})))where rnum=1]]>
  	</select>
  	<select id="s_pre" parameterType="int" resultType="com.sist.model.ShareeDTO">
  		<![CDATA[select * from (select p.*, row_number() over(order by s_group desc,s_step) rnum from sharee p where s_group=(select min(s_group) from (select s_group from sharee where s_group>#{s_group})))where rnum=1]]>
  	</select>
<!--   	<select id="s_next" parameterType="int" resultType="com.sist.model.ShareeDTO">
  		<![CDATA[select * from sharee where s_no=(select max(s_no) from sharee where s_step=0 and s_no<#{s_no})]]>
  	</select>
  	<select id="s_pre" parameterType="int" resultType="com.sist.model.ShareeDTO">
  		<![CDATA[select * from sharee where s_no=(select min(s_no) from sharee where s_step=0 and s_no>#{s_no})]]>
  	</select> -->
  	
  	 <select id="s_groupcount" resultType="int" parameterType="int">
  		select count(*) from sharee where s_group=#{s_group}
  	</select>
  	<update id="s_replyupdate" parameterType="com.sist.model.ShareeDTO">
  		<![CDATA[update sharee set s_check=1 where  s_group= #{s_group} and s_indent=#{s_indent}+1 and s_step>#{s_step} and s_step<(select min(s_nextstep) from (select lead(s_step) over(order by s_group desc, s_step) s_nextstep from sharee where s_group= #{s_group} and s_indent=#{s_indent} order by s_group desc,s_step))]]> 
  	</update>
  	<update id="s_replyupdate2" parameterType="com.sist.model.ShareeDTO">
  		<![CDATA[update sharee set s_check=1 where  s_group= #{s_group} and s_indent=#{s_indent}+1 and s_step>#{s_step}]]>  
  	</update>
  	<select id="s_replycheck" parameterType="com.sist.model.ShareeDTO" resultType="String">
  		select min(s_nextstep) from (select lead(s_step) over(order by s_group desc, s_step) s_nextstep from sharee where s_group= #{s_group} and s_indent=#{s_indent} order by s_group desc,s_step)
  	</select>
  	
</mapper>